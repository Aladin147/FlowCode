# FlowCode v0.1 - AI-Powered Code Quality Extension

A VS Code extension that enforces code quality through automated gates and AI-powered refactoring assistance.

## Overview

FlowCode implements a **dual-gate system** for code quality enforcement:
- **Companion Guard**: Real-time linting and type-checking (<500ms response)
- **Final Guard**: Comprehensive pre-push validation with tests and security scanning
- **Architect Service**: Cloud-based AI refactoring via OpenAI/Anthropic APIs
- **Hotfix System**: Emergency fixes with 48-hour technical debt tracking

## Installation

### From VSIX (Alpha Testing)
1. Download `flowcode-0.1.0-alpha.vsix`
2. Open VS Code → Extensions → `...` → Install from VSIX
3. Select the downloaded file

### From Source
```bash
git clone <repository-url>
cd FlowCodeV0.1
npm install
npm run compile
```

## Configuration

### API Keys Setup
1. Open Command Palette (`Ctrl+Shift+P`)
2. Run `FlowCode: Configure API Key`
3. Select provider (OpenAI/Anthropic)
4. Enter your API key

### Settings
Access via `File → Preferences → Settings → Extensions → FlowCode`

| Setting | Description | Default |
|---------|-------------|---------|
| `flowcode.openai.apiKey` | OpenAI API key | `""` |
| `flowcode.anthropic.apiKey` | Anthropic API key | `""` |
| `flowcode.debtFilePath` | Hotfix debt tracking file | `.flowcode/debt.json` |
| `flowcode.gitHooksDir` | Git hooks directory | `.git/hooks` |

## Available Commands

Access these commands via the Command Palette (`Ctrl+Shift+P` / `Cmd+Shift+P`):

| Command | Description | Shortcut |
|---------|-------------|----------|
| `FlowCode: Elevate to Architect` | AI-powered code refactoring | `Ctrl+Alt+A` |
| `FlowCode: Generate Code` | Generate code from description | - |
| `FlowCode: Run Security Audit` | Comprehensive security scan | - |
| `FlowCode: Show Code Graph` | Visualize code dependencies | - |
| `FlowCode: Configure API Key` | Set up AI provider credentials | - |
| `FlowCode: Create Hotfix` | Emergency fix with debt tracking | `Ctrl+Alt+H` |
| `FlowCode: Run Health Check` | System health diagnostics | - |
| `FlowCode: Show Status` | Extension status dashboard | - |

## Features

### 1. Companion Guard (Real-time)

**Trigger**: File save or 500ms after typing stops

- **TypeScript/JavaScript**: ESLint + TypeScript compiler
- **Python**: Ruff linting
- **Response time**: <500ms
- **Visual**: Status bar indicators

### 2. Final Guard (Pre-push)

**Trigger**: Git push

- **Test suite**: Full npm test execution
- **Security scan**: Semgrep SAST
- **Language support**: TypeScript, JavaScript, Python
- **Blocking**: Prevents push on failures

### 3. Architect Service (AI Refactoring)

**Trigger**: Command palette or hotkey

- **Providers**: OpenAI GPT-4-turbo, Claude-Opus
- **Context**: Selected code + file structure
- **Languages**: TypeScript, JavaScript, Python
- **Output**: In-place code replacement

### 4. Hotfix System

**Trigger**: Emergency situations

- **Process**: Creates hotfix branch with minimal checks
- **Debt tracking**: 48-hour SLA for proper resolution
- **Monitoring**: Visual indicators for overdue hotfixes

### 5. Code Graph Visualization
**Trigger**: Command palette on active file
- **Technology**: Lazy-loaded Code Property Graph
- **Features**: Call graphs, taint analysis
- **Display**: VS Code webview with D3.js

## Commands

| Command | Description | Keybinding |
|---------|-------------|------------|
| `FlowCode: Initialize` | Setup git hooks and configuration | - |
| `FlowCode: Elevate to Architect` | AI refactor selected code | `Ctrl+Shift+A` |
| `FlowCode: Create Hotfix` | Emergency fix with debt tracking | `Ctrl+Shift+H` |
| `FlowCode: Show Code Graph` | Visualize code relationships | `Ctrl+Shift+G` |
| `FlowCode: Configure API Key` | Setup AI provider credentials | - |

## Architecture

### Service Layer
```
src/
├── services/
│   ├── companion-guard.ts      # Real-time quality checks
│   ├── final-guard.ts         # Pre-push validation
│   ├── architect-service.ts   # AI refactoring
│   ├── graph-service.ts       # Code visualization
│   └── hotfix-service.ts      # Emergency fixes
├── utils/
│   └── configuration-manager.ts # Settings management
├── ui/
│   └── status-bar-manager.ts   # Visual indicators
└── extension.ts               # VS Code integration
```

### Git Hooks Integration
- **Pre-commit**: `.git/hooks/pre-commit` (Companion Guard)
- **Pre-push**: `.git/hooks/pre-push` (Final Guard)

### File Structure
```
workspace/
├── .flowcode/
│   └── debt.json              # Hotfix tracking
├── .git/hooks/
│   ├── pre-commit            # Generated by FlowCode
│   └── pre-push              # Generated by FlowCode
└── src/                      # Your project code
```

## Development

### Prerequisites
- Node.js ≥ 18.x
- VS Code ≥ 1.102.0
- Git ≥ 2.30.0

### Setup
```bash
# Install dependencies
npm install

# Compile TypeScript
npm run compile

# Run linting
npm run lint

# Package extension
npm run package

# Run tests
npm test
```

### Debugging
1. Open project in VS Code
2. Press `F5` to launch Extension Development Host
3. Test commands in the new VS Code window
4. Check Output panel → FlowCode for logs

## Testing

### Manual Testing Checklist
- [ ] Extension activates without errors
- [ ] API key configuration works
- [ ] Companion Guard triggers on file save
- [ ] Final Guard blocks bad pushes
- [ ] Architect refactoring works with selection
- [ ] Hotfix creation tracks debt properly
- [ ] Code graph displays correctly
- [ ] Git hooks install successfully

### Test Commands
```bash
# Test compilation
npm run compile

# Test packaging
npm run package

# Test extension
code --install-extension flowcode-0.1.0-alpha.vsix
```

## Troubleshooting

### Common Issues

**Extension fails to activate**
- Check VS Code version ≥ 1.102.0
- Verify Node.js installation
- Check Output panel for errors

**Git hooks not working**
- Ensure Git ≥ 2.30.0
- Check `.git/hooks/` directory permissions
- Run `FlowCode: Initialize` command

**AI refactoring fails**
- Verify API key configuration
- Check internet connectivity
- Review API rate limits

**TypeScript compilation errors**
- Run `npm run compile` to check
- Ensure all dependencies installed
- Check `tsconfig.json` configuration

### Debug Mode
Enable detailed logging:
1. Open VS Code settings
2. Search for "FlowCode"
3. Set log level to "debug"
4. Check Output panel → FlowCode

## API Reference

### ConfigurationManager
```typescript
class ConfigurationManager {
    getWorkspaceRoot(): Promise<string>
    getApiConfiguration(): Promise<{provider: string, apiKey: string}>
    getDebtFilePath(): Promise<string>
    getGitHooksDirectory(): Promise<string>
}
```

### ArchitectService
```typescript
class ArchitectService {
    refactor(code: string, context: {language: string, filePath: string}): Promise<string>
}
```

### HotfixService
```typescript
class HotfixService {
    createHotfix(message: string): Promise<void>
    getPendingHotfixes(): Promise<HotfixRecord[]>
    resolveHotfix(hotfixId: string): Promise<void>
}
```

## Contributing

1. Fork the repository
2. Create feature branch: `git checkout -b feature/amazing-feature`
3. Commit changes: `git commit -m 'Add amazing feature'`
4. Push to branch: `git push origin feature/amazing-feature`
5. Open pull request

## License

MIT License - see [LICENSE](LICENSE) file for details.

## Support

- **Issues**: [GitHub Issues](https://github.com/Aladin147/FlowCode/issues)
- **Discussions**: [GitHub Discussions](https://github.com/Aladin147/FlowCode/discussions)
- **Email**: support@flowcode.dev